from telegram import Update, KeyboardButton, ReplyKeyboardMarkup
from telegram.ext import (
    Application,
    CommandHandler,
    MessageHandler,
    filters,
    ContextTypes
)

TOKEN = "7828105755:AAEuc-u-XtNStadlLoSYW5hm8fJeBhKcMQY"

topics = {
    "–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ": [
        ("Student", "–°—Ç—É–¥–µ–Ω—Ç (–º.), –°—Ç—É–¥–µ–Ω—Ç–∫–∞ (–∂.)"),
        ("Teacher", "–£—á–∏—Ç–µ–ª—å (–º.), –£—á–∏—Ç–µ–ª—å–Ω–∏—Ü–∞ (–∂.)"),
        ("School", "–®–∫–æ–ª–∞"),
        ("University", "–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç"),
        ("Exam", "–≠–∫–∑–∞–º–µ–Ω"),
        ("Homework", "–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ"),
        ("Book", "–ö–Ω–∏–≥–∞"),
        ("Lecture", "–õ–µ–∫—Ü–∏—è"),
        ("Grade", "–û—Ü–µ–Ω–∫–∞"),
        ("Diploma", "–î–∏–ø–ª–æ–º")
    ],
    "–ú–µ–¥–∏—Ü–∏–Ω–∞": [
        ("Doctor", "–î–æ–∫—Ç–æ—Ä, –≤—Ä–∞—á"),
        ("Hospital", "–ë–æ–ª—å–Ω–∏—Ü–∞"),
        ("Medicine", "–õ–µ–∫–∞—Ä—Å—Ç–≤–æ"),
        ("Nurse", "–ú–µ–¥—Å–µ—Å—Ç—Ä–∞"),
        ("Patient", "–ü–∞—Ü–∏–µ–Ω—Ç"),
        ("Surgery", "–û–ø–µ—Ä–∞—Ü–∏—è"),
        ("Pain", "–ë–æ–ª—å"),
        ("Prescription", "–†–µ—Ü–µ–ø—Ç"),
        ("Vaccine", "–í–∞–∫—Ü–∏–Ω–∞"),
        ("Ambulance", "–°–∫–æ—Ä–∞—è –ø–æ–º–æ—â—å")
    ],
    "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏": [
        ("Computer", "–ö–æ–º–ø—å—é—Ç–µ—Ä"),
        ("Internet", "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç"),
        ("Software", "–ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ (–ü–û)"),
        ("Smartphone", "–°–º–∞—Ä—Ç—Ñ–æ–Ω"),
        ("Robot", "–†–æ–±–æ—Ç"),
        ("Artificial Intelligence (AI)", "–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç (–ò–ò)"),
        ("Data", "–î–∞–Ω–Ω—ã–µ"),
        ("Algorithm", "–ê–ª–≥–æ—Ä–∏—Ç–º"),
        ("Cybersecurity", "–ö–∏–±–µ—Ä–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å"),
        ("Virtual Reality (VR)", "–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å (–í–†)")
    ],
    "–ü–æ–ª–∏—Ç–∏–∫–∞": [
        ("President", "–ü—Ä–µ–∑–∏–¥–µ–Ω—Ç"),
        ("Government", "–ü—Ä–∞–≤–∏—Ç–µ–ª—å—Å—Ç–≤–æ"),
        ("Election", "–í—ã–±–æ—Ä—ã"),
        ("Law", "–ó–∞–∫–æ–Ω"),
        ("Democracy", "–î–µ–º–æ–∫—Ä–∞—Ç–∏—è"),
        ("Minister", "–ú–∏–Ω–∏—Å—Ç—Ä"),
        ("Party (political)", "–ü–∞—Ä—Ç–∏—è"),
        ("Corruption", "–ö–æ—Ä—Ä—É–ø—Ü–∏—è"),
        ("Diplomacy", "–î–∏–ø–ª–æ–º–∞—Ç–∏—è"),
        ("Revolution", "–†–µ–≤–æ–ª—é—Ü–∏—è")
    ],
    "–ò—Å—Ç–æ—Ä–∏—è": [
        ("War", "–í–æ–π–Ω–∞"),
        ("Empire", "–ò–º–ø–µ—Ä–∏—è"),
        ("Revolution", "–†–µ–≤–æ–ª—é—Ü–∏—è"),
        ("Ancient", "–î—Ä–µ–≤–Ω–∏–π"),
        ("Civilization", "–¶–∏–≤–∏–ª–∏–∑–∞—Ü–∏—è"),
        ("Battle", "–ë–∏—Ç–≤–∞"),
        ("King", "–ö–æ—Ä–æ–ª—å"),
        ("Queen", "–ö–æ—Ä–æ–ª–µ–≤–∞"),
        ("Discovery", "–û—Ç–∫—Ä—ã—Ç–∏–µ"),
        ("Century", "–í–µ–∫")
    ]
}

def get_main_keyboard():
    buttons = [
        [KeyboardButton("–í—ã–±–æ—Ä —Ç–µ–º—ã")],
        [KeyboardButton("–ù–∞—á–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ")],
        [KeyboardButton("–ü–æ–∏—Å–∫ —Å–ª–æ–≤–∞")],
        [KeyboardButton("–ü–æ–º–æ—â—å")],
        [KeyboardButton("–û –ø—Ä–æ–µ–∫—Ç–µ")]
    ]
    return ReplyKeyboardMarkup(buttons, resize_keyboard=True)

def get_topics_keyboard():
    topics_buttons = [[KeyboardButton(topic)] for topic in topics]
    topics_buttons.append([KeyboardButton("–ù–∞–∑–∞–¥")])
    return ReplyKeyboardMarkup(topics_buttons, resize_keyboard=True)

def get_study_keyboard():
    return ReplyKeyboardMarkup([
        [KeyboardButton("–°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ"), KeyboardButton("–ü—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–ª–æ–≤–æ")],
        [KeyboardButton("–ù–∞–∑–∞–¥")]
    ], resize_keyboard=True)



async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "Hello! –ù–∞ —Å–≤—è–∑–∏ –±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –≤—ã—É—á–∏—Ç—å –Ω–æ–≤—ã–µ —Å–ª–æ–≤–∞ –ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Ç–µ–º–µ. "
        "–°–∫–æ—Ä–µ–µ –Ω–∞—á–∏–Ω–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞—à–∏–º –±–æ—Ç–æ–º. –ù–∞–¥–µ–µ–º—Å—è, –æ–Ω —Ç–µ–±–µ –ø–æ–º–æ–∂–µ—Ç)",
        reply_markup=get_main_keyboard()
    )

async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    text = update.message.text
    user_data = context.user_data
    
    if text == "–í—ã–±–æ—Ä —Ç–µ–º—ã":
        await update.message.reply_text(
            "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É:",
            reply_markup=get_topics_keyboard()
        )
    elif text in topics:
        user_data["selected_topic"] = text
        user_data["current_index"] = 0
        await update.message.reply_text(
            f"–í—ã –≤—ã–±—Ä–∞–ª–∏ —Ç–µ–º—É: {text}. –ù–∞–∂–º–∏—Ç–µ '–°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ' –¥–ª—è –Ω–∞—á–∞–ª–∞.",
            reply_markup=get_study_keyboard()
        )

    elif text == "–°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ":
        topic = user_data.get("selected_topic")
        index = user_data.get("current_index", 0)

        if topic:
            words = topics[topic]
            if index < len(words):
                eng, rus = words[index]
                await update.message.reply_text(f"{index + 1}. {eng} ‚Äì {rus}")
                user_data["current_index"] = index + 1
            else:
                await update.message.reply_text("üéâ –í—ã –∏–∑—É—á–∏–ª–∏ –≤—Å–µ —Å–ª–æ–≤–∞ –≤ —ç—Ç–æ–π —Ç–µ–º–µ!")
        else:
            await update.message.reply_text("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É —á–µ—Ä–µ–∑ '–í—ã–±–æ—Ä —Ç–µ–º—ã'.")

    elif text == "–ü—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–ª–æ–≤–æ":
        topic = user_data.get("selected_topic")
        index = user_data.get("current_index", 0)

        if topic and index > 1:
            index -= 2
            user_data["current_index"] = index
            words = topics[topic]
            eng, rus = words[index]
            await update.message.reply_text(f"{index + 1}. {eng} ‚Äì {rus}")
            user_data["current_index"] = index + 1
        elif topic and index == 1:
            user_data["current_index"] = 0
            eng, rus = topics[topic][0]
            await update.message.reply_text(f"1. {eng} ‚Äì {rus}")
            user_data["current_index"] = 1
        else:
            await update.message.reply_text("–ù–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–ª–æ–≤–∞.")

    elif text == "–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ–º—É":
        topic = user_data.get("selected_topic")
        if topic:
            user_data["current_index"] = 0
            await update.message.reply_text(
                f"–¢–µ–º–∞ '{topic}' –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ '–°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ'."
            )
        else:
            await update.message.reply_text("–í—ã –µ—â—ë –Ω–µ –≤—ã–±—Ä–∞–ª–∏ —Ç–µ–º—É.")


    elif text in topics:
        words_list = [f"{i+1}. {eng} ‚Äì {rus}" for i, (eng, rus) in enumerate(topics[text])]
        response = f"### {text}\n" + "\n".join(words_list)
        await update.message.reply_text(response)
    
    elif text == "–ù–∞—á–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ":
        await update.message.reply_text("–§—É–Ω–∫—Ü–∏—è –∏–∑—É—á–µ–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ")
    
    elif text == "–ü–æ–∏—Å–∫ —Å–ª–æ–≤–∞":
        await update.message.reply_text("–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞:")
    
    elif text == "–ü–æ–º–æ—â—å":
        await update.message.reply_text("–í–æ–∑–Ω–∏–∫ –≤–æ–ø—Ä–æ—Å? –û–±—Ä–∞—â–∞–π—Ç–µ—Å—å –ø–æ –∞–¥—Ä–µ—Å—É: @nessska_a")
    
    elif text == "–û –ø—Ä–æ–µ–∫—Ç–µ":
        await update.message.reply_text(
            "–î–∞–Ω–Ω—ã–π –±–æ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞–º–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã'–¶–∏—Ñ—Ä–æ–≤–æ–π –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫. –ü–æ—Å—Ç—Ä–µ–¥–∞–∫—Ç–æ—Ä PRO':\n"
            "–°–∞–≤–∏–Ω—ã—Ö –ê–Ω–∞—Å—Ç–∞—Å–∏—è - —Ç–∏–º–ª–∏–¥\n"
            "–ß—É—Ö–≤–∞–Ω—Ü–µ–≤–∞ –î–∞—Ä—å—è\n"
            "–®–∞—Ä–∏—Ñ—É–ª–ª–∏–Ω –†—É—Å–ª–∞–Ω\n"
            "–ò–≥–æ–ª–∫–∏–Ω –í–ª–∞–¥–∏–º–∏—Ä\n"
            "–†–∞—Ö–º–æ–Ω–∫—É–ª–æ–≤ –ê–∑–∏–∑–±–µ–∫\n"
            "–Ø—Ä—É–ª–ª–∏–Ω –≠–ª—å–¥–∞—Ä"
        )
    
    elif text == "–ù–∞–∑–∞–¥":
        await update.message.reply_text(
            "–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:",
            reply_markup=get_main_keyboard()
        )
    
    else:
        await update.message.reply_text("–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞")

def main():
    app = Application.builder().token(TOKEN).build()
    
    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT, handle_message))
    
    print("–ë–æ—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω!")
    app.run_polling()

if __name__ == "__main__":
    main()
